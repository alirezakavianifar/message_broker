<!DOCTYPE html><html><head>
<title>DEPLOYMENT_GUIDE_FA.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/*

Arduino® Light Theme - Stefania Mellai <s.mellai@arduino.cc>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #FFFFFF;
}

.hljs,
.hljs-subst {
  color: #434f54;
}

.hljs-keyword,
.hljs-attribute,
.hljs-selector-tag,
.hljs-doctag,
.hljs-name {
  color: #00979D;
}

.hljs-built_in,
.hljs-literal,
.hljs-bullet,
.hljs-code,
.hljs-addition {
  color: #D35400;
}

.hljs-regexp,
.hljs-symbol,
.hljs-variable,
.hljs-template-variable,
.hljs-link,
.hljs-selector-attr,
.hljs-selector-pseudo {
  color: #00979D;
}

.hljs-type,
.hljs-string,
.hljs-selector-id,
.hljs-selector-class,
.hljs-quote,
.hljs-template-tag,
.hljs-deletion {
  color: #005C5F;
}

.hljs-title,
.hljs-section {
  color: #880000;
  font-weight: bold;
}

.hljs-comment {
  color: rgba(149,165,166,.8);
}

.hljs-meta-keyword {
  color: #728E00;
}

.hljs-meta {
  color: #434f54;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

.hljs-function {
  color: #728E00;
}

.hljs-number {
  color: #8A7B52;  
}

</style>

<style>
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family:   "HelveticaNeue-Light", sans-serif, "宋体","Segoe WPC", "Segoe UI", "SFUIText-Light","Droid Sans Fallback";
	font-size: 18px;
	padding: 0 12px;
	line-height: 1.6;
	word-wrap: break-word;
	color: #333333;
}

.content-wrapper{
	max-width: 860px;
    margin: 0 auto;
    padding: 0 30px;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}


body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	color: #4080D0;
	text-decoration: none;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom: 1px solid #eee;
}


h2{
	padding-bottom: .3em;
    font-size: 2em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

h3{
	font-size: 1.75em;
    line-height: 1.225;
}

h1, h2, h3 {
	font-weight: bold;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
	font-size: inherit;
	line-height: auto;
}

a:hover {
	color: #4080D0;
	text-decoration: underline;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left: 5px solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 14px;
	line-height: 19px;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

.mac code {
	font-size: 12px;
	line-height: 18px;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

/** Theming */

.vscode-light,
.vscode-light pre code {
	color: rgb(30, 30, 30);
}

.vscode-dark,
.vscode-dark pre code {
	color: #DDD;
}

.vscode-high-contrast,
.vscode-high-contrast pre code {
	color: white;
}

.vscode-light code {
	color: #A31515;
}

.vscode-dark code {
	color: #D7BA7D;
}

.vscode-light pre:not(.hljs),
.vscode-light code > div {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre:not(.hljs),
.vscode-dark code > div {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre:not(.hljs),
.vscode-high-contrast code > div {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

.vscode-light blockquote,
.vscode-dark blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.vscode-high-contrast blockquote {
	background: transparent;
	border-color: #fff;
}
</style>

<style>
pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

.table-of-contents li{
	list-style-type: initial;
}
</style>

<style>
@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{text-rendering:auto;font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.16.2"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{align-items:baseline;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-box;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}

</style>

</head>
<body>
    <div class="content-wrapper">
        <h1 id="%D8%B1%D8%A7%D9%87%D9%86%D9%85%D8%A7%DB%8C-%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85-%DA%A9%D8%A7%D8%B1%DA%AF%D8%B2%D8%A7%D8%B1-%D9%BE%DB%8C%D8%A7%D9%85" tabindex="-1">راهنمای راه‌اندازی سیستم کارگزار پیام</h1>
<p><strong>نسخه</strong>: 1.0.0<br>
<strong>سیستم عامل</strong>: ویندوز سرور / لینوکس<br>
<strong>تاریخ</strong>: نوامبر 2025</p>
<hr>
<h2 id="%D9%81%D9%87%D8%B1%D8%B3%D8%AA-%D9%85%D8%B7%D8%A7%D9%84%D8%A8" tabindex="-1">فهرست مطالب</h2>
<ol>
<li><a href="#%D9%85%D8%B9%D8%B1%D9%81%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85">معرفی سیستم</a></li>
<li><a href="#%D9%BE%DB%8C%D8%B4-%D9%86%DB%8C%D8%A7%D8%B2%D9%87%D8%A7">پیش‌نیازها</a></li>
<li><a href="#%D8%B1%D8%A7%D9%87-%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D8%AF%D8%B1-%D9%88%DB%8C%D9%86%D8%AF%D9%88%D8%B2">راه‌اندازی در ویندوز</a></li>
<li><a href="#%D8%B1%D8%A7%D9%87-%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D8%AF%D8%B1-%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3">راه‌اندازی در لینوکس</a></li>
<li><a href="#%D9%BE%DB%8C%DA%A9%D8%B1%D8%A8%D9%86%D8%AF%DB%8C">پیکربندی</a></li>
<li><a href="#%D9%85%D8%AF%DB%8C%D8%B1%DB%8C%D8%AA-%DA%AF%D9%88%D8%A7%D9%87%DB%8C-%D9%86%D8%A7%D9%85%D9%87">مدیریت گواهی‌نامه</a></li>
<li><a href="#%D8%A7%D8%AC%D8%B1%D8%A7%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85">اجرای سیستم</a></li>
<li><a href="#%D9%85%D8%AF%DB%8C%D8%B1%DB%8C%D8%AA-%D8%B3%D8%B1%D9%88%DB%8C%D8%B3">مدیریت سرویس</a></li>
<li><a href="#%D8%B9%DB%8C%D8%A8-%DB%8C%D8%A7%D8%A8%DB%8C">عیب‌یابی</a></li>
</ol>
<hr>
<h2 id="%D9%85%D8%B9%D8%B1%D9%81%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85" tabindex="-1">معرفی سیستم</h2>
<p>سیستم کارگزار پیام از 4 بخش اصلی تشکیل شده است:</p>
<ul>
<li><strong>سرور اصلی</strong> (پورت 8000): رابط برنامه‌نویسی مرکزی، پایگاه داده، احراز هویت</li>
<li><strong>سرور پروکسی</strong> (پورت 8001): رابط برنامه‌نویسی سمت کلاینت با احراز هویت دوطرفه</li>
<li><strong>کارگر</strong> (Worker): پردازش پیام‌ها از صف Redis</li>
<li><strong>پورتال وب</strong> (پورت 5000): رابط وب برای مشاهده پیام‌ها</li>
</ul>
<h3 id="%D9%85%D8%B9%D9%85%D8%A7%D8%B1%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85" tabindex="-1">معماری سیستم</h3>
<pre class="hljs"><code><div>کلاینت -&gt; پروکسی (8001) -&gt; صف Redis -&gt; کارگر -&gt; سرور اصلی (8000) -&gt; MySQL
                                                          ↓
                                                     پورتال وب (5000)
</div></code></pre>
<hr>
<h2 id="%D9%BE%DB%8C%D8%B4%E2%80%8C%D9%86%DB%8C%D8%A7%D8%B2%D9%87%D8%A7" tabindex="-1">پیش‌نیازها</h2>
<h3 id="%D9%86%D8%B1%D9%85%E2%80%8C%D8%A7%D9%81%D8%B2%D8%A7%D8%B1%D9%87%D8%A7%DB%8C-%D9%85%D9%88%D8%B1%D8%AF-%D9%86%DB%8C%D8%A7%D8%B2" tabindex="-1">نرم‌افزارهای مورد نیاز</h3>
<p><strong>برای هر دو پلتفرم:</strong></p>
<ul>
<li>Python 3.8 یا بالاتر</li>
<li>MySQL 8.0 یا بالاتر</li>
<li>Redis 6.0 یا بالاتر (یا Memurai در ویندوز)</li>
<li>OpenSSL 3.0 یا بالاتر</li>
</ul>
<p><strong>ویندوز اضافی:</strong></p>
<ul>
<li>PowerShell 5.1 یا بالاتر</li>
</ul>
<p><strong>لینوکس اضافی:</strong></p>
<ul>
<li>systemd (برای مدیریت سرویس)</li>
</ul>
<h3 id="%D9%BE%D9%88%D8%B1%D8%AA%E2%80%8C%D9%87%D8%A7%DB%8C-%D8%B4%D8%A8%DA%A9%D9%87" tabindex="-1">پورت‌های شبکه</h3>
<ul>
<li><strong>8000</strong>: سرور اصلی (HTTPS)</li>
<li><strong>8001</strong>: سرور پروکسی (HTTPS با احراز هویت دوطرفه)</li>
<li><strong>5000</strong>: پورتال وب (HTTP)</li>
<li><strong>3306</strong>: MySQL</li>
<li><strong>6379</strong>: Redis</li>
<li><strong>9100+</strong>: متریک‌های کارگر (اختیاری)</li>
</ul>
<hr>
<h2 id="%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D8%AF%D8%B1-%D9%88%DB%8C%D9%86%D8%AF%D9%88%D8%B2" tabindex="-1">راه‌اندازی در ویندوز</h2>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-1%3A-%D9%86%D8%B5%D8%A8-%D9%88%D8%A7%D8%A8%D8%B3%D8%AA%DA%AF%DB%8C%E2%80%8C%D9%87%D8%A7" tabindex="-1">مرحله 1: نصب وابستگی‌ها</h3>
<h4 id="%D8%B1%D9%88%D8%B4-%D8%A7%D9%88%D9%84%3A-%D8%A7%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D9%87-%D8%A7%D8%B2-chocolatey-(%D8%AA%D9%88%D8%B5%DB%8C%D9%87-%D9%85%DB%8C%E2%80%8C%D8%B4%D9%88%D8%AF)" tabindex="-1">روش اول: استفاده از Chocolatey (توصیه می‌شود)</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># نصب Chocolatey در صورت عدم وجود</span>
<span class="hljs-built_in">Set-ExecutionPolicy</span> Bypass <span class="hljs-literal">-Scope</span> <span class="hljs-keyword">Process</span> <span class="hljs-literal">-Force</span>
[<span class="hljs-type">System.Net.ServicePointManager</span>]::SecurityProtocol = [<span class="hljs-type">System.Net.ServicePointManager</span>]::SecurityProtocol <span class="hljs-operator">-bor</span> <span class="hljs-number">3072</span>
<span class="hljs-built_in">iex</span> ((<span class="hljs-built_in">New-Object</span> System.Net.WebClient).DownloadString(<span class="hljs-string">'https://community.chocolatey.org/install.ps1'</span>))

<span class="hljs-comment"># نصب وابستگی‌ها</span>
choco install mysql redis<span class="hljs-literal">-64</span> openssl python3 <span class="hljs-literal">-y</span>
</div></code></pre>
<h4 id="%D8%B1%D9%88%D8%B4-%D8%AF%D9%88%D9%85%3A-%D9%86%D8%B5%D8%A8-%D8%AF%D8%B3%D8%AA%DB%8C" tabindex="-1">روش دوم: نصب دستی</h4>
<ol>
<li>دانلود و نصب MySQL 8.0 از سایت mysql.com</li>
<li>دانلود و نصب Memurai (سازگار با Redis) از سایت memurai.com</li>
<li>دانلود و نصب OpenSSL از سایت slproweb.com/products/Win32OpenSSL.html</li>
<li>دانلود و نصب Python 3.8 یا بالاتر از سایت python.org</li>
</ol>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-2%3A-%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D9%BE%D8%A7%DB%8C%DA%AF%D8%A7%D9%87-%D8%AF%D8%A7%D8%AF%D9%87" tabindex="-1">مرحله 2: راه‌اندازی پایگاه داده</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># راه‌اندازی MySQL</span>
net <span class="hljs-built_in">start</span> MySQL80

<span class="hljs-comment"># ایجاد پایگاه داده</span>
mysql <span class="hljs-literal">-u</span> root <span class="hljs-literal">-p</span>
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> DATABASE message_system <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'systemuser'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'YourStrongPassword123!'</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> message_system.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'systemuser'</span>@<span class="hljs-string">'localhost'</span>;
FLUSH PRIVILEGES;
EXIT;
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-3%3A-%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D9%85%D8%AD%DB%8C%D8%B7-python" tabindex="-1">مرحله 3: راه‌اندازی محیط Python</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># رفتن به دایرکتوری پروژه</span>
<span class="hljs-built_in">cd</span> C:\MessageBroker

<span class="hljs-comment"># ایجاد محیط مجازی</span>
python <span class="hljs-literal">-m</span> venv venv

<span class="hljs-comment"># فعال‌سازی محیط مجازی</span>
.\venv\Scripts\Activate.ps1

<span class="hljs-comment"># نصب وابستگی‌ها</span>
pip install <span class="hljs-literal">-r</span> main_server/requirements.txt
pip install <span class="hljs-literal">-r</span> proxy/requirements.txt
pip install <span class="hljs-literal">-r</span> worker/requirements.txt
pip install <span class="hljs-literal">-r</span> portal/requirements.txt
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-4%3A-%D9%85%D9%82%D8%AF%D8%A7%D8%B1%D8%AF%D9%87%DB%8C-%D8%A7%D9%88%D9%84%DB%8C%D9%87-%D8%B3%D8%A7%D8%AE%D8%AA%D8%A7%D8%B1-%D9%BE%D8%A7%DB%8C%DA%AF%D8%A7%D9%87-%D8%AF%D8%A7%D8%AF%D9%87" tabindex="-1">مرحله 4: مقداردهی اولیه ساختار پایگاه داده</h3>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
alembic upgrade head
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-5%3A-%D8%AA%D9%88%D9%84%DB%8C%D8%AF-%DA%AF%D9%88%D8%A7%D9%87%DB%8C%E2%80%8C%D9%86%D8%A7%D9%85%D9%87%E2%80%8C%D9%87%D8%A7" tabindex="-1">مرحله 5: تولید گواهی‌نامه‌ها</h3>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server

<span class="hljs-comment"># مقداردهی اولیه مرجع گواهی</span>
.\init_ca.bat

<span class="hljs-comment"># تولید گواهی‌نامه‌های سرور</span>
.\generate_cert.bat server
.\generate_cert.bat proxy
.\generate_cert.bat worker

<span class="hljs-comment"># تولید گواهی‌نامه کلاینت تست</span>
.\generate_cert.bat test_client
</div></code></pre>
<p>کپی گواهی‌نامه‌ها به دایرکتوری‌های مناسب:</p>
<ul>
<li><code>proxy.crt</code> و <code>proxy.key</code> -&gt; <code>proxy/certs/</code></li>
<li><code>worker.crt</code> و <code>worker.key</code> -&gt; <code>worker/certs/</code></li>
<li>کپی <code>ca.crt</code> به <code>proxy/certs/</code> و <code>worker/certs/</code></li>
</ul>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-6%3A-%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%DA%A9%D8%A7%D8%B1%D8%A8%D8%B1-%D9%85%D8%AF%DB%8C%D8%B1" tabindex="-1">مرحله 6: ایجاد کاربر مدیر</h3>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
python admin_cli.py users create <span class="hljs-literal">--email</span> admin@example.com <span class="hljs-literal">--password</span> AdminPass123! <span class="hljs-literal">--role</span> admin
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-7%3A-%D9%BE%DB%8C%DA%A9%D8%B1%D8%A8%D9%86%D8%AF%DB%8C-%D9%85%D8%AD%DB%8C%D8%B7" tabindex="-1">مرحله 7: پیکربندی محیط</h3>
<p>ایجاد فایل <code>.env</code> در ریشه پروژه:</p>
<pre class="hljs"><code><div># پایگاه داده
DATABASE_URL=mysql+pymysql://systemuser:YourStrongPassword123!@localhost/message_system

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# رمزهای عبور (در محیط تولید حتما تغییر دهید!)
JWT_SECRET=your-production-secret-key-min-32-chars
HASH_SALT=your-production-salt-change-this

# سرور اصلی
MAIN_SERVER_URL=https://localhost:8000
MAIN_SERVER_HOST=0.0.0.0
MAIN_SERVER_PORT=8000

# لاگ
LOG_LEVEL=INFO
LOG_FILE_PATH=logs
</div></code></pre>
<hr>
<h2 id="%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D8%AF%D8%B1-%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3" tabindex="-1">راه‌اندازی در لینوکس</h2>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-1%3A-%D9%86%D8%B5%D8%A8-%D9%88%D8%A7%D8%A8%D8%B3%D8%AA%DA%AF%DB%8C%E2%80%8C%D9%87%D8%A7-1" tabindex="-1">مرحله 1: نصب وابستگی‌ها</h3>
<p><strong>اوبونتو/دبیان:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> apt update
<span class="hljs-built_in">sudo</span> apt install -y python3 python3-pip python3-venv mysql-server redis-server openssl
</div></code></pre>
<p><strong>CentOS/RHEL:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">sudo</span> yum install -y python3 python3-pip mysql-server redis openssl
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-2%3A-%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D9%BE%D8%A7%DB%8C%DA%AF%D8%A7%D9%87-%D8%AF%D8%A7%D8%AF%D9%87-1" tabindex="-1">مرحله 2: راه‌اندازی پایگاه داده</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># راه‌اندازی MySQL</span>
<span class="hljs-built_in">sudo</span> systemctl start mysql
<span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> mysql

<span class="hljs-comment"># امن‌سازی نصب MySQL</span>
<span class="hljs-built_in">sudo</span> mysql_secure_installation

<span class="hljs-comment"># ایجاد پایگاه داده</span>
<span class="hljs-built_in">sudo</span> mysql -u root -p
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> DATABASE message_system <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'systemuser'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'YourStrongPassword123!'</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> message_system.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'systemuser'</span>@<span class="hljs-string">'localhost'</span>;
FLUSH PRIVILEGES;
EXIT;
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-3%3A-%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D9%85%D8%AD%DB%8C%D8%B7-python-1" tabindex="-1">مرحله 3: راه‌اندازی محیط Python</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># رفتن به دایرکتوری پروژه</span>
<span class="hljs-built_in">cd</span> /opt/message_broker

<span class="hljs-comment"># ایجاد محیط مجازی</span>
python3 -m venv venv

<span class="hljs-comment"># فعال‌سازی محیط مجازی</span>
<span class="hljs-built_in">source</span> venv/bin/activate

<span class="hljs-comment"># نصب وابستگی‌ها</span>
pip install -r main_server/requirements.txt
pip install -r proxy/requirements.txt
pip install -r worker/requirements.txt
pip install -r portal/requirements.txt
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-4%3A-%D9%85%D9%82%D8%AF%D8%A7%D8%B1%D8%AF%D9%87%DB%8C-%D8%A7%D9%88%D9%84%DB%8C%D9%87-%D8%B3%D8%A7%D8%AE%D8%AA%D8%A7%D8%B1-%D9%BE%D8%A7%DB%8C%DA%AF%D8%A7%D9%87-%D8%AF%D8%A7%D8%AF%D9%87-1" tabindex="-1">مرحله 4: مقداردهی اولیه ساختار پایگاه داده</h3>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
alembic upgrade <span class="hljs-built_in">head</span>
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-5%3A-%D8%AA%D9%88%D9%84%DB%8C%D8%AF-%DA%AF%D9%88%D8%A7%D9%87%DB%8C%E2%80%8C%D9%86%D8%A7%D9%85%D9%87%E2%80%8C%D9%87%D8%A7-1" tabindex="-1">مرحله 5: تولید گواهی‌نامه‌ها</h3>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server/certs

<span class="hljs-comment"># تولید کلید خصوصی مرجع گواهی</span>
openssl genrsa -out ca.key 4096
<span class="hljs-built_in">chmod</span> 600 ca.key

<span class="hljs-comment"># تولید گواهی مرجع گواهی</span>
openssl req -new -x509 -days 3650 -key ca.key -out ca.crt \
    -subj <span class="hljs-string">"/CN=MessageBrokerCA/O=MessageBroker/C=US"</span>
<span class="hljs-built_in">chmod</span> 644 ca.crt

<span class="hljs-comment"># تولید گواهی‌نامه سرور</span>
<span class="hljs-built_in">mkdir</span> -p ../certs
openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr \
    -subj <span class="hljs-string">"/CN=server/O=MessageBroker/C=US"</span>
openssl x509 -req -<span class="hljs-keyword">in</span> server.csr -CA ca.crt -CAkey ca.key \
    -CAcreateserial -out server.crt -days 365 -sha256
<span class="hljs-built_in">chmod</span> 600 server.key
<span class="hljs-built_in">chmod</span> 644 server.crt

<span class="hljs-comment"># تولید گواهی‌نامه پروکسی</span>
<span class="hljs-built_in">cd</span> ../proxy/certs
openssl genrsa -out proxy.key 2048
openssl req -new -key proxy.key -out proxy.csr \
    -subj <span class="hljs-string">"/CN=proxy/O=MessageBroker/C=US"</span>
openssl x509 -req -<span class="hljs-keyword">in</span> proxy.csr -CA ../../main_server/certs/ca.crt \
    -CAkey ../../main_server/certs/ca.key -CAcreateserial \
    -out proxy.crt -days 365 -sha256
<span class="hljs-built_in">chmod</span> 600 proxy.key
<span class="hljs-built_in">chmod</span> 644 proxy.crt

<span class="hljs-comment"># کپی گواهی مرجع به پروکسی</span>
<span class="hljs-built_in">cp</span> ../../main_server/certs/ca.crt .

<span class="hljs-comment"># تولید گواهی‌نامه کارگر</span>
<span class="hljs-built_in">cd</span> ../../worker/certs
openssl genrsa -out worker.key 2048
openssl req -new -key worker.key -out worker.csr \
    -subj <span class="hljs-string">"/CN=worker/O=MessageBroker/C=US"</span>
openssl x509 -req -<span class="hljs-keyword">in</span> worker.csr -CA ../../main_server/certs/ca.crt \
    -CAkey ../../main_server/certs/ca.key -CAcreateserial \
    -out worker.crt -days 365 -sha256
<span class="hljs-built_in">chmod</span> 600 worker.key
<span class="hljs-built_in">chmod</span> 644 worker.crt

<span class="hljs-comment"># کپی گواهی مرجع به کارگر</span>
<span class="hljs-built_in">cp</span> ../../main_server/certs/ca.crt .
</div></code></pre>
<p><strong>یا استفاده از CLI مدیریتی:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
<span class="hljs-built_in">source</span> ../venv/bin/activate
python admin_cli.py certificates generate server
python admin_cli.py certificates generate proxy
python admin_cli.py certificates generate worker
python admin_cli.py certificates generate test_client
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-6%3A-%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%DA%A9%D8%A7%D8%B1%D8%A8%D8%B1-%D9%85%D8%AF%DB%8C%D8%B1-1" tabindex="-1">مرحله 6: ایجاد کاربر مدیر</h3>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
<span class="hljs-built_in">source</span> ../venv/bin/activate
python admin_cli.py <span class="hljs-built_in">users</span> create --email admin@example.com --password AdminPass123! --role admin
</div></code></pre>
<h3 id="%D9%85%D8%B1%D8%AD%D9%84%D9%87-7%3A-%D9%BE%DB%8C%DA%A9%D8%B1%D8%A8%D9%86%D8%AF%DB%8C-%D9%85%D8%AD%DB%8C%D8%B7-1" tabindex="-1">مرحله 7: پیکربندی محیط</h3>
<p>ایجاد فایل <code>.env</code> در ریشه پروژه (<code>/opt/message_broker/.env</code>):</p>
<pre class="hljs"><code><div># پایگاه داده
DATABASE_URL=mysql+pymysql://systemuser:YourStrongPassword123!@localhost/message_system

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# رمزهای عبور (در محیط تولید حتما تغییر دهید!)
JWT_SECRET=your-production-secret-key-min-32-chars
HASH_SALT=your-production-salt-change-this

# سرور اصلی
MAIN_SERVER_URL=https://localhost:8000
MAIN_SERVER_HOST=0.0.0.0
MAIN_SERVER_PORT=8000

# لاگ
LOG_LEVEL=INFO
LOG_FILE_PATH=/opt/message_broker/logs
</div></code></pre>
<hr>
<h2 id="%D8%A7%D8%AC%D8%B1%D8%A7%DB%8C-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85" tabindex="-1">اجرای سیستم</h2>
<h3 id="%D9%88%DB%8C%D9%86%D8%AF%D9%88%D8%B2---%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D8%AF%D8%B3%D8%AA%DB%8C" tabindex="-1">ویندوز - راه‌اندازی دستی</h3>
<h4 id="%D8%B1%D9%88%D8%B4-%D8%A7%D9%88%D9%84%3A-%D8%A7%D8%B3%D8%AA%D9%81%D8%A7%D8%AF%D9%87-%D8%A7%D8%B2-%D8%A7%D8%B3%DA%A9%D8%B1%DB%8C%D9%BE%D8%AA-%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-(%D8%B3%D8%A7%D8%AF%D9%87%E2%80%8C%D8%AA%D8%B1%DB%8C%D9%86-%D8%B1%D9%88%D8%B4)" tabindex="-1">روش اول: استفاده از اسکریپت راه‌اندازی (ساده‌ترین روش)</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># راه‌اندازی همه سرویس‌ها به صورت همزمان</span>
.\start_all_services.ps1

<span class="hljs-comment"># یا راه‌اندازی در حالت خاموش (پس‌زمینه)</span>
.\start_all_services.ps1 <span class="hljs-literal">-Silent</span>
</div></code></pre>
<h4 id="%D8%B1%D9%88%D8%B4-%D8%AF%D9%88%D9%85%3A-%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D8%AC%D8%AF%D8%A7%DA%AF%D8%A7%D9%86%D9%87" tabindex="-1">روش دوم: راه‌اندازی جداگانه</h4>
<p>باز کردن 4 پنجره PowerShell جداگانه:</p>
<p><strong>ترمینال 1 - سرور اصلی:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
..\venv\Scripts\Activate.ps1
.\start_server.ps1
</div></code></pre>
<p><strong>ترمینال 2 - پروکسی:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> proxy
..\venv\Scripts\Activate.ps1
.\start_proxy.ps1
</div></code></pre>
<p><strong>ترمینال 3 - کارگر:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> worker
..\venv\Scripts\Activate.ps1
.\start_worker.ps1
</div></code></pre>
<p><strong>ترمینال 4 - پورتال:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> portal
..\venv\Scripts\Activate.ps1
.\start_portal.ps1
</div></code></pre>
<h3 id="%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3---%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D8%AF%D8%B3%D8%AA%DB%8C" tabindex="-1">لینوکس - راه‌اندازی دستی</h3>
<p>باز کردن 4 پنجره ترمینال جداگانه:</p>
<p><strong>ترمینال 1 - سرور اصلی:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> /opt/message_broker/main_server
<span class="hljs-built_in">source</span> ../venv/bin/activate
uvicorn main_server.api:app --host 0.0.0.0 --port 8000 \
    --ssl-keyfile certs/server.key \
    --ssl-certfile certs/server.crt \
    --ssl-ca-certs certs/ca.crt
</div></code></pre>
<p><strong>ترمینال 2 - پروکسی:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> /opt/message_broker/proxy
<span class="hljs-built_in">source</span> ../venv/bin/activate
uvicorn app:app --host 0.0.0.0 --port 8001 \
    --ssl-keyfile certs/proxy.key \
    --ssl-certfile certs/proxy.crt \
    --ssl-ca-certs certs/ca.crt \
    --workers 4
</div></code></pre>
<p><strong>ترمینال 3 - کارگر:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> /opt/message_broker/worker
<span class="hljs-built_in">source</span> ../venv/bin/activate
python worker.py
</div></code></pre>
<p><strong>ترمینال 4 - پورتال:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> /opt/message_broker/portal
<span class="hljs-built_in">source</span> ../venv/bin/activate
uvicorn app:app --host 0.0.0.0 --port 5000
</div></code></pre>
<h3 id="%D8%A8%D8%B1%D8%B1%D8%B3%DB%8C-%D8%B5%D8%AD%D8%AA-%D8%A7%D8%AC%D8%B1%D8%A7%DB%8C-%D8%B3%D8%B1%D9%88%DB%8C%D8%B3%E2%80%8C%D9%87%D8%A7" tabindex="-1">بررسی صحت اجرای سرویس‌ها</h3>
<p><strong>ویندوز:</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment"># بررسی پورت‌ها</span>
<span class="hljs-built_in">Get-NetTCPConnection</span> <span class="hljs-literal">-LocalPort</span> <span class="hljs-number">8000</span>,<span class="hljs-number">8001</span>,<span class="hljs-number">5000</span>

<span class="hljs-comment"># بررسی نقاط سلامت</span>
<span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-literal">-Uri</span> https://localhost:<span class="hljs-number">8000</span>/health <span class="hljs-literal">-SkipCertificateCheck</span>
<span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-literal">-Uri</span> https://localhost:<span class="hljs-number">8001</span>/api/v1/health <span class="hljs-literal">-SkipCertificateCheck</span>
<span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-literal">-Uri</span> http://localhost:<span class="hljs-number">5000</span>
</div></code></pre>
<p><strong>لینوکس:</strong></p>
<pre class="hljs"><code><div><span class="hljs-comment"># بررسی پورت‌ها</span>
<span class="hljs-built_in">sudo</span> netstat -tlnp | grep -E <span class="hljs-string">'8000|8001|5000'</span>

<span class="hljs-comment"># بررسی نقاط سلامت</span>
curl -k https://localhost:8000/health
curl -k https://localhost:8001/api/v1/health
curl http://localhost:5000
</div></code></pre>
<hr>
<h2 id="%D9%85%D8%AF%DB%8C%D8%B1%DB%8C%D8%AA-%D8%B3%D8%B1%D9%88%DB%8C%D8%B3" tabindex="-1">مدیریت سرویس</h2>
<h3 id="%D9%88%DB%8C%D9%86%D8%AF%D9%88%D8%B2---%D9%86%D8%B5%D8%A8-%D8%A8%D9%87-%D8%B9%D9%86%D9%88%D8%A7%D9%86-%D8%B3%D8%B1%D9%88%DB%8C%D8%B3" tabindex="-1">ویندوز - نصب به عنوان سرویس</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># نصب همه سرویس‌ها</span>
<span class="hljs-built_in">cd</span> deployment/services
.\install_all_services.ps1

<span class="hljs-comment"># راه‌اندازی سرویس‌ها</span>
net <span class="hljs-built_in">start</span> MessageBrokerMainServer
net <span class="hljs-built_in">start</span> MessageBrokerProxy
net <span class="hljs-built_in">start</span> MessageBrokerWorker
net <span class="hljs-built_in">start</span> MessageBrokerPortal

<span class="hljs-comment"># توقف سرویس‌ها</span>
net stop MessageBrokerPortal
net stop MessageBrokerWorker
net stop MessageBrokerProxy
net stop MessageBrokerMainServer

<span class="hljs-comment"># بررسی وضعیت</span>
<span class="hljs-built_in">Get-Service</span> MessageBroker*
</div></code></pre>
<h3 id="%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3---%D9%86%D8%B5%D8%A8-%D8%A8%D9%87-%D8%B9%D9%86%D9%88%D8%A7%D9%86-%D8%B3%D8%B1%D9%88%DB%8C%D8%B3-systemd" tabindex="-1">لینوکس - نصب به عنوان سرویس systemd</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># کپی فایل‌های سرویس</span>
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> main_server/main_server.service /etc/systemd/system/
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> proxy/proxy.service /etc/systemd/system/
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> worker/worker.service /etc/systemd/system/
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> portal/portal.service /etc/systemd/system/

<span class="hljs-comment"># ایجاد کاربر سرویس</span>
<span class="hljs-built_in">sudo</span> useradd -r -s /bin/false messagebroker
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> -R messagebroker:messagebroker /opt/message_broker

<span class="hljs-comment"># تنظیم دسترسی‌ها</span>
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 700 /opt/message_broker/main_server/certs
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 600 /opt/message_broker/main_server/certs/*.key
<span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 600 /opt/message_broker/main_server/secrets/*

<span class="hljs-comment"># فعال‌سازی و راه‌اندازی</span>
<span class="hljs-built_in">sudo</span> systemctl daemon-reload
<span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> main_server proxy worker portal
<span class="hljs-built_in">sudo</span> systemctl start main_server proxy worker portal

<span class="hljs-comment"># بررسی وضعیت</span>
<span class="hljs-built_in">sudo</span> systemctl status main_server
<span class="hljs-built_in">sudo</span> systemctl status proxy
<span class="hljs-built_in">sudo</span> systemctl status worker
<span class="hljs-built_in">sudo</span> systemctl status portal

<span class="hljs-comment"># مشاهده لاگ‌ها</span>
<span class="hljs-built_in">sudo</span> journalctl -u main_server -f
<span class="hljs-built_in">sudo</span> journalctl -u proxy -f
<span class="hljs-built_in">sudo</span> journalctl -u worker -f
<span class="hljs-built_in">sudo</span> journalctl -u portal -f
</div></code></pre>
<hr>
<h2 id="%D9%85%D8%AF%DB%8C%D8%B1%DB%8C%D8%AA-%DA%AF%D9%88%D8%A7%D9%87%DB%8C%E2%80%8C%D9%86%D8%A7%D9%85%D9%87" tabindex="-1">مدیریت گواهی‌نامه</h2>
<h3 id="%D8%AA%D9%88%D9%84%DB%8C%D8%AF-%DA%AF%D9%88%D8%A7%D9%87%DB%8C%E2%80%8C%D9%86%D8%A7%D9%85%D9%87-%DA%A9%D9%84%D8%A7%DB%8C%D9%86%D8%AA" tabindex="-1">تولید گواهی‌نامه کلاینت</h3>
<p><strong>ویندوز:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
.\generate_cert.bat client_name
</div></code></pre>
<p><strong>لینوکس:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
<span class="hljs-built_in">mkdir</span> -p certs/clients/client_name
<span class="hljs-built_in">cd</span> certs/clients/client_name

<span class="hljs-comment"># تولید کلید خصوصی</span>
openssl genrsa -out client_name.key 2048

<span class="hljs-comment"># تولید درخواست امضا</span>
openssl req -new -key client_name.key -out client_name.csr \
    -subj <span class="hljs-string">"/CN=client_name/O=MessageBroker/C=US"</span>

<span class="hljs-comment"># امضا با مرجع گواهی</span>
openssl x509 -req -<span class="hljs-keyword">in</span> client_name.csr \
    -CA ../../ca.crt -CAkey ../../ca.key -CAcreateserial \
    -out client_name.crt -days 365 -sha256

<span class="hljs-comment"># کپی گواهی مرجع</span>
<span class="hljs-built_in">cp</span> ../../ca.crt .
</div></code></pre>
<h3 id="%D8%A8%D8%A7%D8%B7%D9%84-%DA%A9%D8%B1%D8%AF%D9%86-%DA%AF%D9%88%D8%A7%D9%87%DB%8C%E2%80%8C%D9%86%D8%A7%D9%85%D9%87" tabindex="-1">باطل کردن گواهی‌نامه</h3>
<p><strong>ویندوز:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
.\revoke_cert.bat client_name
</div></code></pre>
<p><strong>لینوکس:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
openssl ca -revoke certs/clients/client_name/client_name.crt \
    -keyfile certs/ca.key -cert certs/ca.crt
openssl ca -gencrl -out crl/revoked.pem -keyfile certs/ca.key -cert certs/ca.crt
</div></code></pre>
<h3 id="%D9%84%DB%8C%D8%B3%D8%AA-%DA%AF%D9%88%D8%A7%D9%87%DB%8C%E2%80%8C%D9%86%D8%A7%D9%85%D9%87%E2%80%8C%D9%87%D8%A7" tabindex="-1">لیست گواهی‌نامه‌ها</h3>
<p><strong>ویندوز:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server
.\list_certs.bat
</div></code></pre>
<p><strong>لینوکس:</strong></p>
<pre class="hljs"><code><div><span class="hljs-built_in">cd</span> main_server/certs/clients
<span class="hljs-keyword">for</span> <span class="hljs-built_in">dir</span> <span class="hljs-keyword">in</span> */; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"کلاینت: <span class="hljs-variable">$dir</span>"</span>
    openssl x509 -<span class="hljs-keyword">in</span> <span class="hljs-variable">${dir}</span><span class="hljs-variable">${dir%/}</span>.crt -noout -subject -dates
<span class="hljs-keyword">done</span>
</div></code></pre>
<hr>
<h2 id="%D8%AA%D8%B3%D8%AA-%D8%B3%DB%8C%D8%B3%D8%AA%D9%85" tabindex="-1">تست سیستم</h2>
<h3 id="1.-%D8%AF%D8%B3%D8%AA%D8%B1%D8%B3%DB%8C-%D8%A8%D9%87-%D9%BE%D9%88%D8%B1%D8%AA%D8%A7%D9%84-%D9%88%D8%A8" tabindex="-1">1. دسترسی به پورتال وب</h3>
<p>باز کردن مرورگر: <code>http://localhost:5000</code></p>
<p>ورود با اطلاعات مدیر ایجاد شده قبلی.</p>
<h3 id="2.-%D8%A7%D8%B1%D8%B3%D8%A7%D9%84-%D9%BE%DB%8C%D8%A7%D9%85-%D8%AA%D8%B3%D8%AA" tabindex="-1">2. ارسال پیام تست</h3>
<p><strong>استفاده از کلاینت Python:</strong></p>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> httpx

cert = (<span class="hljs-string">"client-scripts/certs/test_client.crt"</span>, <span class="hljs-string">"client-scripts/certs/test_client.key"</span>)
ca = <span class="hljs-string">"client-scripts/certs/ca.crt"</span>

response = httpx.post(
    <span class="hljs-string">"https://localhost:8001/api/v1/messages"</span>,
    json={
        <span class="hljs-string">"sender_number"</span>: <span class="hljs-string">"+1234567890"</span>,
        <span class="hljs-string">"message_body"</span>: <span class="hljs-string">"پیام تست"</span>
    },
    cert=cert,
    verify=ca
)

<span class="hljs-built_in">print</span>(response.json())
</div></code></pre>
<p><strong>استفاده از curl (در صورت فرمت PEM):</strong></p>
<pre class="hljs"><code><div>curl -k --cert client-scripts/certs/test_client.crt \
     --key client-scripts/certs/test_client.key \
     --cacert client-scripts/certs/ca.crt \
     -X POST https://localhost:8001/api/v1/messages \
     -H <span class="hljs-string">"Content-Type: application/json"</span> \
     -d <span class="hljs-string">'{"sender_number": "+1234567890", "message_body": "پیام تست"}'</span>
</div></code></pre>
<h3 id="3.-%D9%85%D8%B4%D8%A7%D9%87%D8%AF%D9%87-%D9%BE%DB%8C%D8%A7%D9%85-%D8%AF%D8%B1-%D9%BE%D9%88%D8%B1%D8%AA%D8%A7%D9%84" tabindex="-1">3. مشاهده پیام در پورتال</h3>
<ol>
<li>ورود به پورتال در آدرس <code>http://localhost:5000</code></li>
<li>رفتن به بخش پیام‌ها</li>
<li>پیام تست شما باید نمایش داده شود</li>
</ol>
<hr>
<h2 id="%D8%B9%DB%8C%D8%A8%E2%80%8C%DB%8C%D8%A7%D8%A8%DB%8C" tabindex="-1">عیب‌یابی</h2>
<h3 id="%D8%B3%D8%B1%D9%88%DB%8C%D8%B3%E2%80%8C%D9%87%D8%A7-%D8%B1%D8%A7%D9%87%E2%80%8C%D8%A7%D9%86%D8%AF%D8%A7%D8%B2%DB%8C-%D9%86%D9%85%DB%8C%E2%80%8C%D8%B4%D9%88%D9%86%D8%AF" tabindex="-1">سرویس‌ها راه‌اندازی نمی‌شوند</h3>
<p><strong>بررسی لاگ‌ها:</strong></p>
<ul>
<li>ویندوز: <code>Get-Content logs\*.log -Tail 50</code></li>
<li>لینوکس: <code>sudo journalctl -u &lt;service_name&gt; -n 50</code></li>
</ul>
<p><strong>مشکلات رایج:</strong></p>
<ul>
<li>پورت قبلا استفاده شده: <code>netstat -ano | findstr :8000</code> (ویندوز) یا <code>sudo lsof -i :8000</code> (لینوکس)</li>
<li>اتصال پایگاه داده ناموفق: بررسی اجرای MySQL و صحت اطلاعات</li>
<li>اتصال Redis ناموفق: بررسی اجرای Redis (<code>redis-cli ping</code>)</li>
<li>خطاهای گواهی‌نامه: تولید مجدد گواهی‌نامه‌ها با استفاده از <code>init_ca.bat</code> (ویندوز) یا دستورات OpenSSL (لینوکس)</li>
</ul>
<h3 id="%D8%AE%D8%B7%D8%A7%D9%87%D8%A7%DB%8C-%DA%AF%D9%88%D8%A7%D9%87%DB%8C%E2%80%8C%D9%86%D8%A7%D9%85%D9%87" tabindex="-1">خطاهای گواهی‌نامه</h3>
<p><strong>خطا</strong>: "Certificate verify failed"</p>
<ul>
<li>راه حل: تولید مجدد گواهی‌نامه‌ها با استفاده از <code>init_ca.bat</code> (ویندوز) یا دستورات OpenSSL (لینوکس)</li>
<li>اطمینان از هماهنگی گواهی مرجع در همه بخش‌ها</li>
</ul>
<p><strong>خطا</strong>: "Invalid or missing client certificate"</p>
<ul>
<li>راه حل: اطمینان از معتبر بودن گواهی‌نامه کلاینت و امضا شدن آن توسط مرجع گواهی</li>
<li>بررسی عدم انقضای گواهی‌نامه: <code>openssl x509 -in cert.crt -noout -dates</code></li>
</ul>
<h3 id="%D8%AE%D8%B7%D8%A7%D9%87%D8%A7%DB%8C-%D8%A7%D8%AA%D8%B5%D8%A7%D9%84-%D9%BE%D8%A7%DB%8C%DA%AF%D8%A7%D9%87-%D8%AF%D8%A7%D8%AF%D9%87" tabindex="-1">خطاهای اتصال پایگاه داده</h3>
<p><strong>خطا</strong>: "Can't connect to MySQL"</p>
<ul>
<li>بررسی اجرای MySQL: <code>net start MySQL80</code> (ویندوز) یا <code>sudo systemctl status mysql</code> (لینوکس)</li>
<li>بررسی اطلاعات در فایل <code>.env</code></li>
<li>بررسی وجود پایگاه داده: <code>mysql -u systemuser -p -e "SHOW DATABASES;"</code></li>
</ul>
<h3 id="%D8%AE%D8%B7%D8%A7%D9%87%D8%A7%DB%8C-%D8%A7%D8%AA%D8%B5%D8%A7%D9%84-redis" tabindex="-1">خطاهای اتصال Redis</h3>
<p><strong>خطا</strong>: "Connection refused"</p>
<ul>
<li>راه‌اندازی Redis: <code>redis-server --service-start</code> (ویندوز) یا <code>sudo systemctl start redis</code> (لینوکس)</li>
<li>بررسی گوش دادن Redis: <code>redis-cli ping</code> (باید PONG برگرداند)</li>
</ul>
<h3 id="%DA%A9%D8%A7%D8%B1%DA%AF%D8%B1-%D9%BE%DB%8C%D8%A7%D9%85%E2%80%8C%D9%87%D8%A7-%D8%B1%D8%A7-%D9%BE%D8%B1%D8%AF%D8%A7%D8%B2%D8%B4-%D9%86%D9%85%DB%8C%E2%80%8C%DA%A9%D9%86%D8%AF" tabindex="-1">کارگر پیام‌ها را پردازش نمی‌کند</h3>
<p><strong>بررسی:</strong></p>
<ol>
<li>اجرای کارگر</li>
<li>وجود پیام در صف Redis: <code>redis-cli LLEN message_queue</code></li>
<li>دسترسی‌پذیری سرور اصلی از کارگر</li>
<li>معتبر بودن گواهی‌نامه کارگر</li>
</ol>
<h3 id="%D9%85%D8%B4%DA%A9%D9%84%D8%A7%D8%AA-%D9%88%D8%B1%D9%88%D8%AF-%D8%A8%D9%87-%D9%BE%D9%88%D8%B1%D8%AA%D8%A7%D9%84" tabindex="-1">مشکلات ورود به پورتال</h3>
<p><strong>خطا</strong>: "Invalid credentials"</p>
<ul>
<li>ایجاد کاربر مدیر: <code>python admin_cli.py users create --email admin@example.com --password AdminPass123! --role admin</code></li>
<li>بررسی وجود کاربر: <code>python admin_cli.py users list</code></li>
</ul>
<hr>
<h2 id="%DA%86%DA%A9%E2%80%8C%D9%84%DB%8C%D8%B3%D8%AA-%D8%AA%D9%88%D9%84%DB%8C%D8%AF" tabindex="-1">چک‌لیست تولید</h2>
<p>قبل از راه‌اندازی در محیط تولید:</p>
<ul>
<li>تغییر همه رمزهای عبور پیش‌فرض (JWT_SECRET، HASH_SALT، رمزهای پایگاه داده)</li>
<li>تولید مرجع گواهی و گواهی‌نامه‌های جدید (استفاده نکردن از گواهی‌نامه‌های تست)</li>
<li>تنظیم قوانین فایروال (اجازه پورت‌های 8000، 8001، 5000)</li>
<li>تنظیم گواهی‌نامه‌های SSL/TLS برای دامنه تولید</li>
<li>تنظیم چرخش لاگ</li>
<li>تنظیم روش‌های پشتیبان‌گیری پایگاه داده</li>
<li>تنظیم پایداری Redis (فعال‌سازی AOF)</li>
<li>تنظیم مانیتورینگ (Prometheus/Grafana)</li>
<li>تنظیم failover و افزونگی</li>
<li>بازبینی و سخت‌سازی تنظیمات امنیتی</li>
<li>تست روش‌های پشتیبان‌گیری و بازیابی</li>
<li>مستندسازی امن اطلاعات تولید</li>
</ul>
<hr>
<h2 id="%D9%BE%D8%B4%D8%AA%DB%8C%D8%A8%D8%A7%D9%86%DB%8C-%D9%88-%D9%85%D8%B3%D8%AA%D9%86%D8%AF%D8%A7%D8%AA" tabindex="-1">پشتیبانی و مستندات</h2>
<h3 id="%D9%85%D8%B3%D8%AA%D9%86%D8%AF%D8%A7%D8%AA-api" tabindex="-1">مستندات API</h3>
<ul>
<li>API سرور اصلی: <code>https://localhost:8000/docs</code></li>
<li>API پروکسی: <code>https://localhost:8001/api/v1/docs</code></li>
</ul>
<h3 id="%D8%A8%D8%B1%D8%B1%D8%B3%DB%8C-%D8%B3%D9%84%D8%A7%D9%85%D8%AA" tabindex="-1">بررسی سلامت</h3>
<ul>
<li>سرور اصلی: <code>https://localhost:8000/health</code></li>
<li>پروکسی: <code>https://localhost:8001/api/v1/health</code></li>
<li>متریک‌ها: <code>https://localhost:8000/metrics</code></li>
</ul>
<h3 id="%D9%85%D8%AD%D9%84-%D9%84%D8%A7%DA%AF%E2%80%8C%D9%87%D8%A7" tabindex="-1">محل لاگ‌ها</h3>
<p><strong>ویندوز:</strong></p>
<ul>
<li>سرور اصلی: <code>logs/main_server.log</code></li>
<li>پروکسی: <code>logs/proxy.log</code></li>
<li>کارگر: <code>logs/worker.log</code></li>
<li>پورتال: <code>logs/portal.log</code></li>
</ul>
<p><strong>لینوکس:</strong></p>
<ul>
<li>لاگ‌های systemd: <code>sudo journalctl -u &lt;service_name&gt;</code></li>
<li>لاگ‌های برنامه: <code>/opt/message_broker/logs/*.log</code></li>
</ul>
<hr>
<h2 id="%D8%AF%D8%B3%D8%AA%D9%88%D8%B1%D8%A7%D8%AA-%D9%85%D8%B1%D8%AC%D8%B9-%D8%B3%D8%B1%DB%8C%D8%B9" tabindex="-1">دستورات مرجع سریع</h2>
<h3 id="%D9%88%DB%8C%D9%86%D8%AF%D9%88%D8%B2" tabindex="-1">ویندوز</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># راه‌اندازی همه سرویس‌ها</span>
.\start_all_services.ps1

<span class="hljs-comment"># توقف همه سرویس‌ها</span>
.\stop_all_services.ps1

<span class="hljs-comment"># بررسی وضعیت سرویس</span>
<span class="hljs-built_in">Get-Service</span> MessageBroker*

<span class="hljs-comment"># مشاهده لاگ‌ها</span>
<span class="hljs-built_in">Get-Content</span> logs\*.log <span class="hljs-literal">-Tail</span> <span class="hljs-number">50</span>
</div></code></pre>
<h3 id="%D9%84%DB%8C%D9%86%D9%88%DA%A9%D8%B3" tabindex="-1">لینوکس</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># راه‌اندازی همه سرویس‌ها</span>
<span class="hljs-built_in">sudo</span> systemctl start main_server proxy worker portal

<span class="hljs-comment"># توقف همه سرویس‌ها</span>
<span class="hljs-built_in">sudo</span> systemctl stop portal worker proxy main_server

<span class="hljs-comment"># بررسی وضعیت</span>
<span class="hljs-built_in">sudo</span> systemctl status main_server proxy worker portal

<span class="hljs-comment"># مشاهده لاگ‌ها</span>
<span class="hljs-built_in">sudo</span> journalctl -u main_server -f
</div></code></pre>
<hr>
<p><strong>پایان راهنمای راه‌اندازی</strong></p>

    </div>


</body></html>